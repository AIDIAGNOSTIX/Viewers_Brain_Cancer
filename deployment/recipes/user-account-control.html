
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>User Account Control Â· OHIF</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-cornerstone/cornerstone.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../connecting-to-image-archives/google-cloud-healthcare.html" />
    
    
    <link rel="prev" href="nginx--image-archive.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                



<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../our-process.html">
            
                <a href="../../our-process.html">
            
                    
                    Our Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../development/getting-started.html">
            
                <a href="../../development/getting-started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../development/contributing.html">
            
                <a href="../../development/contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../development/continous-integration.html">
            
                <a href="../../development/continous-integration.html">
            
                    
                    Continuous Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../../development/testing.html">
            
                <a href="../../development/testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../configuring/">
            
                <a href="../../configuring/">
            
                    
                    Configuring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../configuring/data-source.html">
            
                <a href="../../configuring/data-source.html">
            
                    
                    Data Source
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../architecture/">
            
                <a href="../../architecture/">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../viewer/">
            
                <a href="../../viewer/">
            
                    
                    Viewer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../../viewer/configuration.html">
            
                <a href="../../viewer/configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../../viewer/themeing.html">
            
                <a href="../../viewer/themeing.html">
            
                    
                    Themeing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../../viewer/internationalization.html">
            
                <a href="../../viewer/internationalization.html">
            
                    
                    Internationalization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../extensions/">
            
                <a href="../../extensions/">
            
                    
                    Extensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../../extensions/">
            
                <a href="../../extensions/#registering-an-extension">
            
                    
                    Registering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../../extensions/">
            
                <a href="../../extensions/#lifecycle-hooks">
            
                    
                    Lifecycle Hooks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.2.1" data-path="../../extensions/lifecycle/pre-registration.html">
            
                <a href="../../extensions/lifecycle/pre-registration.html">
            
                    
                    preRegistration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../../extensions/">
            
                <a href="../../extensions/#modules">
            
                    
                    Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.3.1" data-path="../../extensions/modules/commands.html">
            
                <a href="../../extensions/modules/commands.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.2" data-path="../../extensions/modules/panel.html">
            
                <a href="../../extensions/modules/panel.html">
            
                    
                    Panel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.3" data-path="../../extensions/modules/sop-class-handler.html">
            
                <a href="../../extensions/modules/sop-class-handler.html">
            
                    
                    SOP Class Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.4" data-path="../../extensions/modules/toolbar.html">
            
                <a href="../../extensions/modules/toolbar.html">
            
                    
                    Toolbar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.5" data-path="../../extensions/modules/viewport.html">
            
                <a href="../../extensions/modules/viewport.html">
            
                    
                    Viewport
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="../../extensions/">
            
                <a href="../../extensions/#contexts">
            
                    
                    Contexts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.5" data-path="../../extensions/">
            
                <a href="../../extensions/#extensionmanager">
            
                    
                    ExtensionManager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.6" data-path="../../extensions/">
            
                <a href="../../extensions/#maintained-extensions">
            
                    
                    OHIF Maintained
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../services/">
            
                <a href="../../services/">
            
                    
                    Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../../services/default/">
            
                <a href="../../services/default/">
            
                    
                    Default
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../../services/ui/">
            
                <a href="../../services/ui/">
            
                    
                    UI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.2.1" data-path="../../services/ui/ui-dialog-service.html">
            
                <a href="../../services/ui/ui-dialog-service.html">
            
                    
                    Dialog Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2.2" data-path="../../services/ui/ui-modal-service.html">
            
                <a href="../../services/ui/ui-modal-service.html">
            
                    
                    Modal Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2.3" data-path="../../services/ui/ui-notification-service.html">
            
                <a href="../../services/ui/ui-notification-service.html">
            
                    
                    Notification Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../">
            
                <a href="../">
            
                    
                    Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../">
            
                <a href="../#embedded-viewer">
            
                    
                    Embedded
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../">
            
                <a href="../#stand-alone-viewer">
            
                    
                    Stand-alone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../">
            
                <a href="../#data">
            
                    
                    Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    Recipes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" >
            
                <span>
            
                    
                    Script Include
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1.1" data-path="embedded-viewer.html">
            
                <a href="embedded-viewer.html">
            
                    
                    Embedding the Viewer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2.2" >
            
                <span>
            
                    
                    Stand-Alone
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.2.1" data-path="build-for-production.html">
            
                <a href="build-for-production.html">
            
                    
                    Build for Production
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.2" data-path="static-assets.html">
            
                <a href="static-assets.html">
            
                    
                    Static
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.3" data-path="nginx--image-archive.html">
            
                <a href="nginx--image-archive.html">
            
                    
                    Nginx + Image Archive
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2.2.4" data-path="user-account-control.html">
            
                <a href="user-account-control.html">
            
                    
                    User Account Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.5" data-path="../../connecting-to-image-archives/google-cloud-healthcare.html">
            
                <a href="../../connecting-to-image-archives/google-cloud-healthcare.html">
            
                    
                    Google Cloud Healthcare
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../faq/">
            
                <a href="../../faq/">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../faq/scope-of-project.html">
            
                <a href="../../faq/scope-of-project.html">
            
                    
                    Scope of Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../faq/browser-support.html">
            
                <a href="../../faq/browser-support.html">
            
                    
                    Browser Support
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../../faq/pwa-vs-packaged.html">
            
                <a href="../../faq/pwa-vs-packaged.html">
            
                    
                    PWA vs Packaged
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../help.html">
            
                <a href="../../help.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>



                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
  
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >User Account Control</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="user-account-control"><a name="user-account-control" class="plugin-anchor" href="#user-account-control"><i class="fa fa-link" aria-hidden="true"></i></a>User Account Control</h1>
<blockquote>
<p>DISCLAIMER! We make no claims or guarantees of this approach&apos;s security. If in
doubt, enlist the help of an expert and conduct proper audits.</p>
</blockquote>
<p>Making a viewer and its medical imaging data accessible on the open web can
provide a lot of benefits, but requires additional security to make sure
sensitive information can only be viewed by authorized individuals. Most image
archives are equipped with basic security measures, but they are not
robust/secure enough for the open web.</p>
<p>This guide covers one of many potential production setups that secure our
sensitive data.</p>
<h2 id="overview"><a name="overview" class="plugin-anchor" href="#overview"><i class="fa fa-link" aria-hidden="true"></i></a>Overview</h2>
<p>This guide builds on top of our
<a href="nginx--image-archive.html">Nginx + Image Archive guide</a>,
wherein we used a <a href="https://en.wikipedia.org/wiki/Reverse_proxy" target="_blank"><code>reverse proxy</code></a>
to retrieve resources from our image archive (Orthanc).</p>
<p>To add support for &quot;User Account Control&quot; we introduce
<a href="https://www.keycloak.org/about.html" target="_blank">Keycloak</a>. Keycloak is an open source
Identity and Access Management solution that makes it easy to secure
applications and services with little to no code. We improve upon our
<code>reverse proxy</code> setup by integrating Keycloak and Nginx to create an
<code>authenticating reverse proxy</code>.</p>
<blockquote>
<p>An authenticating reverse proxy is a reverse proxy that only retrieves the
resources on behalf of a client if the client has been authenticated. If a
client is not authenticated they can be redirected to a login page.</p>
</blockquote>
<p>This setup allows us to create a setup similar to the one pictured below:</p>
<div style="text-align: center;">
  <img src="../../assets/img/user-access-control-request-flow.png" alt="request flow example" style="margin: 0 auto;">
  <div><i>simplified request flow diagram</i></div>
</div>


<ul>
<li>All web requests are routed through <code>nginx</code> on our <code>OpenResty</code> image</li>
<li><code>/pacs</code> is a reverse proxy for <code>orthanc</code>&apos;s <code>DICOM Web</code> endpoints<ul>
<li>Requires valid <code>Authorization: Bearer &lt;token&gt;</code> header</li>
</ul>
</li>
<li><code>/pacs-admin</code> is a reverse proxy for <code>orthanc</code>&apos;s Web Admin</li>
<li><code>/auth</code> is a reverse proxy for <code>keycloak</code></li>
<li>All static resources for OHIF Viewer are unprotected and accessible. We have
application logic that will redirect unauthenticated users to the appropriate
<code>keycloak</code> login screen.</li>
</ul>
<h2 id="getting-started"><a name="getting-started" class="plugin-anchor" href="#getting-started"><i class="fa fa-link" aria-hidden="true"></i></a>Getting Started</h2>
<h3 id="requirements"><a name="requirements" class="plugin-anchor" href="#requirements"><i class="fa fa-link" aria-hidden="true"></i></a>Requirements</h3>
<ul>
<li>Docker<ul>
<li><a href="https://docs.docker.com/docker-for-mac/" target="_blank">Docker for Mac</a></li>
<li><a href="https://docs.docker.com/docker-for-windows/" target="_blank">Docker for Windows</a></li>
</ul>
</li>
</ul>
<p><em>Not sure if you have <code>docker</code> installed already? Try running <code>docker --version</code>
in command prompt or terminal</em></p>
<h3 id="setup"><a name="setup" class="plugin-anchor" href="#setup"><i class="fa fa-link" aria-hidden="true"></i></a>Setup</h3>
<p><em>Spin Things Up</em></p>
<ul>
<li>Navigate to <code>&lt;project-root&gt;/docker/OpenResty-Orthanc-Keycloak</code> in your shell</li>
<li>Run <code>docker-compose up</code></li>
</ul>
<p><em>Create Your First User</em></p>
<ul>
<li>Navigate to: <code>http://127.0.0.1/auth/admin</code></li>
<li>Sign in with: <code>admin</code>/<code>password</code></li>
<li>From the top left dropdown, select the <code>Ohif</code> realm</li>
<li>From the left sidebar, under <code>Manage</code>, select <code>Users</code></li>
<li>Click <code>Add User</code><ul>
<li>Username: <code>test</code></li>
<li>Email Verified: <code>ON</code></li>
<li>Click <code>Save</code></li>
</ul>
</li>
<li>Click the <code>Credentials</code> Tab<ul>
<li>New Pasword: <code>test</code></li>
<li>Password Confirmation: <code>test</code></li>
<li>Temporary: <code>OFF</code></li>
<li>Click: <code>Reset Password</code></li>
</ul>
</li>
<li>From the top right dropdown, select <code>Admin</code>, then <code>Sign Out</code></li>
</ul>
<p><em>Sign In</em></p>
<ul>
<li>Navigate to <code>http://127.0.0.1/</code></li>
<li>Username: <code>test</code>, Password: <code>test</code></li>
<li>Click <code>Log In</code></li>
</ul>
<p><em>Upload Your First Study</em></p>
<ul>
<li>Navigate to <code>http://127.0.0.1/pacs-admin</code></li>
<li>If you&apos;re not already logged in, use <code>test</code>/<code>test</code></li>
<li>From the top right, select &quot;Upload&quot;</li>
<li>Click &quot;Select files to upload...&quot; (DICOM)</li>
<li>Click &quot;Start the upload&quot;</li>
<li>Navigate back to <code>http://127.0.0.1/</code> to view your studies in the Study List</li>
</ul>
<h3 id="troubleshooting"><a name="troubleshooting" class="plugin-anchor" href="#troubleshooting"><i class="fa fa-link" aria-hidden="true"></i></a>Troubleshooting</h3>
<p><em>Exit code 137</em></p>
<p>This means Docker ran out of memory. Open Docker Desktop, go to the <code>advanced</code>
tab, and increase the amount of Memory available.</p>
<p><em>Cannot create container for service X</em></p>
<p>Use this one with caution: <code>docker system prune</code></p>
<p><em>X is already running</em></p>
<p>Stop running all containers:</p>
<ul>
<li>Win: <code>docker ps -a -q | ForEach { docker stop $_ }</code></li>
<li>Linux: <code>docker stop $(docker ps -a -q)</code></li>
</ul>
<h3 id="configuration"><a name="configuration" class="plugin-anchor" href="#configuration"><i class="fa fa-link" aria-hidden="true"></i></a>Configuration</h3>
<p>After verifying that everything runs with default configuration values, you will
likely want to update:</p>
<ul>
<li>The domain: <code>http://127.0.0.1</code></li>
<li>Set secure, non-default passwords</li>
<li>Regenerate Keycloak Client Secrets</li>
</ul>
<h4 id="ohif-viewer"><a name="ohif-viewer" class="plugin-anchor" href="#ohif-viewer"><i class="fa fa-link" aria-hidden="true"></i></a>OHIF Viewer</h4>
<p>The OHIF Viewer&apos;s configuration is imported from a static <code>.js</code> file. The
configuration we use is set to a specific file when we build the viewer, and
determined by the env variable: <code>APP_CONFIG</code>. You can see where we set its value
in the <code>dockerfile</code> for this solution:</p>
<p><code>ENV APP_CONFIG=config/docker_openresty-orthanc-keycloak.js</code></p>
<p>You can find the configuration we&apos;re using here:
<code>/public/config/docker_openresty-orthanc-keycloak.js</code></p>
<p>To rebuild the <code>webapp</code> image created by our <code>dockerfile</code> after updating the
Viewer&apos;s configuration, you can run:</p>
<ul>
<li><code>docker-compose build</code> OR</li>
<li><code>docker-compose up --build</code></li>
</ul>
<h4 id="other"><a name="other" class="plugin-anchor" href="#other"><i class="fa fa-link" aria-hidden="true"></i></a>Other</h4>
<p>All other files are found in: <code>/docker/OpenResty-Orthanc-Keycloak/</code></p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Configuration</th>
<th>Docs</th>
</tr>
</thead>
<tbody>
<tr>
<td>OHIF Viewer</td>
<td><a href="https://github.com/OHIF/Viewers/blob/master/platform/viewer/.recipes/OpenResty-Orthanc-Keycloak/dockerfile" target="_blank">dockerfile</a> / <a href="https://github.com/OHIF/Viewers/blob/master/platform/viewer/src/config.js" target="_blank">config.js</a></td>
<td>You&apos;re reading them now!</td>
</tr>
<tr>
<td>OpenResty (Nginx)</td>
<td><a href="https://github.com/OHIF/Viewers/blob/master/platform/viewer/.recipes/OpenResty-Orthanc-Keycloak/config/nginx.conf" target="_blank"><code>/nginx.conf</code></a></td>
<td><a href="https://github.com/zmartzone/lua-resty-openidc" target="_blank">lua-resty-openidc</a></td>
</tr>
<tr>
<td>Orthanc</td>
<td><a href="https://github.com/OHIF/Viewers/blob/master/platform/viewer/.recipes/OpenResty-Orthanc-Keycloak/config/orthanc.json" target="_blank"><code>/orthanc.json</code></a></td>
<td><a href="http://book.orthanc-server.com/users/configuration.html#configuration" target="_blank">Here</a></td>
</tr>
<tr>
<td>Keycloak</td>
<td><a href="https://github.com/OHIF/Viewers/blob/master/platform/viewer/.recipes/OpenResty-Orthanc-Keycloak/config/ohif-keycloak-realm.json" target="_blank"><code>/ohif-keycloak-realm.json</code></a>*</td>
</tr>
</tbody>
</table>
<p>* These are the seed values for Keycloak. They can be manually updated at
<code>http://127.0.0.1/auth/admin</code></p>
<h4 id="keycloak-themeing"><a name="keycloak-themeing" class="plugin-anchor" href="#keycloak-themeing"><i class="fa fa-link" aria-hidden="true"></i></a>Keycloak Themeing</h4>
<p>The <code>Login</code> screen for the <code>ohif-viewer</code> client is using a Custom Keycloak
theme. You can find the source files for it in
<code>/docker/OpenResty-Orthanc-Keycloak/volumes/keycloak-themes/</code>. You can see how
we add it to Keycloak in the <code>docker-compose</code> file, and you can read up on how
to leverage custom themes in
<a href="https://www.keycloak.org/docs/latest/server_development/index.html#_themes" target="_blank">Keycloak&apos;s own docs</a>.</p>
<table>
<thead>
<tr>
<th>Default Theme</th>
<th>OHIF Theme</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../assets/img/keycloak-default-theme.png" alt="Keycloak Default Theme"></td>
<td><img src="../../assets/img/keycloak-ohif-theme.png" alt="Keycloak OHIF Theme"></td>
</tr>
</tbody>
</table>
<h2 id="next-steps"><a name="next-steps" class="plugin-anchor" href="#next-steps"><i class="fa fa-link" aria-hidden="true"></i></a>Next Steps</h2>
<h3 id="deploying-to-production"><a name="deploying-to-production" class="plugin-anchor" href="#deploying-to-production"><i class="fa fa-link" aria-hidden="true"></i></a>Deploying to Production</h3>
<p>While these configuration and docker-compose files model an environment suitable
for production, they are not easy to deploy &quot;as is&quot;. You can either:</p>
<ul>
<li>Manually recreate this environment and deploy built application files <strong>OR</strong></li>
<li>Deploy to a cloud kubernetes provider like
<a href="https://www.digitalocean.com/products/kubernetes/" target="_blank">Digital Ocean</a> <strong>OR</strong><ul>
<li><a href="https://landscape.cncf.io/category=cloud&amp;format=card-mode&amp;grouping=category" target="_blank">See a full list of cloud providers here</a></li>
</ul>
</li>
<li>Find and follow your preferred provider&apos;s guide on setting up
<a href="https://docs.docker.com/get-started/" target="_blank">swarms and stacks</a></li>
</ul>
<h3 id="adding-ssl"><a name="adding-ssl" class="plugin-anchor" href="#adding-ssl"><i class="fa fa-link" aria-hidden="true"></i></a>Adding SSL</h3>
<p>Adding SSL registration and renewal for your domain with Let&apos;s Encrypt that
terminates at Nginx is an incredibly important step toward securing your data.
Here are some resources, specific to this setup, that may be helpful:</p>
<ul>
<li><a href="https://github.com/GUI/lua-resty-auto-ssl" target="_blank">lua-resty-auto-ssl</a></li>
<li><a href="https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/" target="_blank">Let&apos;s Encrypt + Nginx</a></li>
</ul>
<p>While we terminate SSL at Nginx, it may be worth using self signed certificates
for communication between services.</p>
<ul>
<li><a href="https://docs.nginx.com/nginx/admin-guide/security-controls/terminating-ssl-tcp/" target="_blank">SSL Termination for TCP Upstream Servers</a></li>
</ul>
<h3 id="use-postgressql-w-orthanc"><a name="use-postgressql-w-orthanc" class="plugin-anchor" href="#use-postgressql-w-orthanc"><i class="fa fa-link" aria-hidden="true"></i></a>Use PostgresSQL w/ Orthanc</h3>
<p>Orthanc can handle a large amount of data and requests, but if you find that
requests start to slow as you add more and more studies, you may want to
configure your Orthanc instance to use PostgresSQL. Instructions on how to do
that can be found in the
<a href="http://book.orthanc-server.com/users/docker.html" target="_blank"><code>Orthanc Server Book</code></a>, under
&quot;PostgreSQL and Orthanc inside Docker&quot;</p>
<h3 id="improving-this-guide"><a name="improving-this-guide" class="plugin-anchor" href="#improving-this-guide"><i class="fa fa-link" aria-hidden="true"></i></a>Improving This Guide</h3>
<p>Here are some improvements this guide would benefit from, and that we would be
more than happy to accept Pull Requests for:</p>
<ul>
<li>SSL Support</li>
<li>Complete configuration with <code>.env</code> file (or something similar)</li>
<li>Keycloak Theme improvements</li>
<li>Any security issues</li>
<li>One-click deploy to a cloud provider</li>
</ul>
<h2 id="resources"><a name="resources" class="plugin-anchor" href="#resources"><i class="fa fa-link" aria-hidden="true"></i></a>Resources</h2>
<h3 id="misc-helpful-commands"><a name="misc-helpful-commands" class="plugin-anchor" href="#misc-helpful-commands"><i class="fa fa-link" aria-hidden="true"></i></a>Misc. Helpful Commands</h3>
<p><em>Check if <code>nginx.conf</code> is valid:</em></p>
<pre><code class="lang-bash">docker run --rm -t <span class="hljs-_">-a</span> stdout --name my-openresty -v <span class="hljs-variable">$PWD</span>/config/:/usr/<span class="hljs-built_in">local</span>/openresty/nginx/conf/:ro openresty/openresty:alpine-fat openresty -c /usr/<span class="hljs-built_in">local</span>/openresty/nginx/conf/nginx.conf -t
</code></pre>
<p><em>Interact w/ running container:</em></p>
<p><code>docker exec -it CONTAINER_NAME bash</code></p>
<p><em>List running containers:</em></p>
<p><code>docker ps</code></p>
<p><em>Clear Keycloak DB so you can re-seed values:</em></p>
<ul>
<li><code>docker volume prune</code> OR</li>
<li><code>docker volume ls</code> and <code>docker volume rm VOLUME_NAME VOLUME_NAME</code></li>
</ul>
<h3 id="referenced-articles"><a name="referenced-articles" class="plugin-anchor" href="#referenced-articles"><i class="fa fa-link" aria-hidden="true"></i></a>Referenced Articles</h3>
<p>The inspiration for our setup was driven largely by these articles:</p>
<ul>
<li><a href="https://edhull.co.uk/blog/2018-06-06/keycloak-nginx" target="_blank">Securing Nginx with Keycloak</a></li>
<li><a href="https://eclipsesource.com/blogs/2018/01/11/authenticating-reverse-proxy-with-keycloak/" target="_blank">Authenticating Reverse Proxy with Keycloak</a></li>
<li><a href="https://www.jerney.io/secure-apis-kong-keycloak-1/" target="_blank">Securing APIs with Kong and Keycloak</a></li>
</ul>
<p>For more documentation on the software we&apos;ve chosen to use, you may find the
following resources helpful:</p>
<ul>
<li><a href="http://book.orthanc-server.com/users/docker.html" target="_blank">Orthanc for Docker</a></li>
<li><a href="http://www.staticshin.com/programming/definitely-an-open-resty-guide/" target="_blank">OpenResty Guide</a></li>
<li><a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/" target="_blank">Lua Ngx API</a></li>
<li><a href="https://auth0.com/docs/api-auth/which-oauth-flow-to-use" target="_blank">Auth0: Picking a Grant Type</a></li>
</ul>
<p>We chose to use a generic OpenID Connect library on the client, but it&apos;s worth
noting that Keycloak comes packaged with its own:</p>
<ul>
<li><a href="https://github.com/maxmantz/redux-oidc" target="_blank">redux-oidc</a> (Which wraps
<a href="https://github.com/IdentityModel/oidc-client-js/wiki" target="_blank">oidc-client-js</a>)</li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter" target="_blank">Keycloak JavaScript Adapter</a></li>
</ul>
<p>If you&apos;re not already drowning in links, here are some good security resources
for OAuth:</p>
<ul>
<li><a href="https://medium.com/@darutk/diagrams-of-all-the-openid-connect-flows-6968e3990660" target="_blank">Diagrams of OpenID Connect Flows</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#authorization-code" target="_blank">KeyCloak: OpenID Connect Flows</a></li>
</ul>
<p>For a different take on this setup, check out the repositories our community
members put together:</p>
<ul>
<li><a href="https://github.com/mjstealey/ohif-orthanc-dimse-docker" target="_blank">mjstealey/ohif-orthanc-dimse-docker</a></li>
<li><a href="https://github.com/trypag/ohif-orthanc-postgres-docker" target="_blank">trypag/ohif-orthanc-postgres-docker</a></li>
</ul>
<!--
  Links
  -->
<!-- prettier-ignore-start -->
<!-- DOCS -->
<!-- SRC -->
<!-- prettier-ignore-end -->

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                

            </div>

            
                
                <a href="nginx--image-archive.html" class="navigation navigation-prev " aria-label="Previous page: Nginx + Image Archive">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../connecting-to-image-archives/google-cloud-healthcare.html" class="navigation navigation-next " aria-label="Next page: Google Cloud Healthcare">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"User Account Control","level":"3.2.2.4","depth":3,"next":{"title":"Google Cloud Healthcare","level":"3.2.2.5","depth":3,"path":"connecting-to-image-archives/google-cloud-healthcare.md","ref":"connecting-to-image-archives/google-cloud-healthcare.md","articles":[]},"previous":{"title":"Nginx + Image Archive","level":"3.2.2.3","depth":3,"path":"deployment/recipes/nginx--image-archive.md","ref":"deployment/recipes/nginx--image-archive.md","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","theme-cornerstone","-fontsettings","github","ga","anchors","versions"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/OHIF/Viewers"},"search":{},"theme-cornerstone":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"highlight":{},"sitemap":{"hostname":"https://docs.ohif.org","todo":"sitemap plugin removed; causing build errors"},"ga":{"configuration":"auto","token":"UA-110573590-2"},"versions":{"type":"branches","gitbookConfigURL":"https://raw.githubusercontent.com/OHIF/Viewers/master/docs/book.json","options":[{"value":"https://docs.ohif.org/history/v1/","text":"Version 1.0.0 (Meteor)"},{"value":"https://docs.ohif.org/","text":"Version 2.0.0","selected":true}]},"sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/OHIF/Viewers/edit/master/docs"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"OHIF","links":{"sharing":{"facebook":false,"twitter":false}},"gitbook":">3.0.0","description":"Documentation for the OHIF framework"},"file":{"path":"deployment/recipes/user-account-control.md","mtime":"2023-05-17T14:00:48.715Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-05-17T14:01:55.313Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-versions/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    </body>
</html>

